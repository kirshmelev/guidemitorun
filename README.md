# Пошаговое руководство по сборке проекта на 11ty внутри экосистемы GitHub, используя свой домен

В этом примере показано, как настроить репозиторий и экшен и подключить свой домен `example.com` к GitHub для автоматической сборки и публикации проекта на 11ty.

*Заметка №1* — для выполнения этого руководства необходимо заранее создать репозиторий GitHub и выгрузить в него файлы проекта на 11ty.

*Заметка №2* — для того, чтобы это работало в бесплатной версии GitHub, необходимо чтобы ваш репозиторий был публичным, доступным всем.

## Шаг 1. Настройка репозитория
1. Переходим в свой `репозиторий с кодом > Settings > Pages`
2. В разделе `Build and deployment`, параметру `Source` устанавливаем значение `GitHub Actions`
3. В разделе `Custom domain` указываем наше доменное имя, например `example.com`, нажимаем `save`
На этом этапе возникнет ошибка проверки dns, так  и должно быть.

## Шаг 2. Настройка dns-записей
Переходим к своему DNS-провайдеру и создаём запись ALIAS A. Для поддержки IPv6 можно также создать запись AAAA.
1. Создаём записи A для домена `example.com`, указывающие на следующие IP адреса
 185.199.108.153
 185.199.109.153
 185.199.110.153
 185.199.111.153
2. Создаём записи AAAA для домена `example.com`, указывающие на следующие IP адреса
 2606:50c0:8000::153
 2606:50c0:8001::153
 2606:50c0:8002::153
 2606:50c0:8003::153
3. Проделываем пункты 1 и 2 для домена `www.example.com`

## Шаг 3. Ещё немного настройки Pages
1. Переходим в свой `репозиторий с кодом > Settings > Pages`
2. В разделе `Custom domain`, где отображается ошибка `(InvalidDNSError)`, нажимаем кнопку `Check again`
2.1. Если ошибка осталось, необходимо подождать, пока обнновяться DNS записи и попробовать ещё раз позже
3. Ниже отмечаем флажёк `HTTPS`

## Шаг 4. Создаём экшен
1. в репозитории создаём файл, расположенный по пути `/.github\workflows/deploy.yml`
2. Добавляем в него следующий код
```yml
name: Deploy static content to Pages

on:
  # Этот экшен собирает и публикует сайт, когда мы делаем пуш в ветку main,
  # если необходимо, можно изменить название ветки в этом блоке
  push:
    branches: ["Main"]

  # Этот код разрешает запуск экшена вручную
  workflow_dispatch:

# Этот код получает разрешения на работу с GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Настраиваем преоритезацию и запрещаем отмену во время процесса.
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # сборка и публикация
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [16]
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}

      - run: set -eu
# Сборка с помощью скрипта build, если проект собирается с помощью скрипта с другим названием, его можно поменять тут
      - run: npm i
      - run: npm run build
      - uses: actions/configure-pages@v3
      - uses: actions/upload-pages-artifact@v2
        with:
          # Публикация проекта. Тут можно изменить имя публикуемой папки.
          path: 'site'
        id: deployment
      - uses: actions/deploy-pages@v2
```
3. Сохраняем изменения, не забываем сделать коммит и пуш в репозиторий

Если всё сделано правильно, при следующем пуше в выбраную ветку, сайт автоматический обновиться на домене `example.com``.
Также, публикацию можно инициировать вручную, запустив экшен `deploy` в разделе `actions` репозитория.